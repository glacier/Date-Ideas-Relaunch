<!DOCTYPE html>
<html>
<head>
  <title>DateIdeas.ca - <%= yield(:title) ||  "Home" %></title>
  <%= stylesheet_link_tag :all %>
  <%= javascript_include_tag :defaults %>
  <%= csrf_meta_tag %>
  <%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js","jquery.rails.js" %>
  <script type="text/javascript">
  $(document).ready(function(){

      //When you click on a link with class of poplight and the href starts with a #
      $('a.poplight[href^=#]').click(function() {
          var popID = $(this).attr('rel'); //Get Popup Name
          var popURL = $(this).attr('href'); //Get Popup href to define size

          //Pull Query & Variables from href URL
          var query= popURL.split('?');
          var dim= query[1].split('&');
          var popWidth = dim[0].split('=')[1]; //Gets the first query string value

          //Fade in the Popup and add close button
          $('#' + popID).fadeIn().css({ 'width': Number( popWidth ) }).prepend('<a href="#" class="close"><img src="/images/close_pop.jpeg" class="btn_close" title="Close Window" alt="Close" width="16px" height="16"/></a>');

          //Define margin for center alignment (vertical + horizontal) - we add 80 to the height/width to accomodate for the padding + border width defined in the css
          var popMargTop = ($('#' + popID).height() + 100) / 2;
          var popMargLeft = ($('#' + popID).width() + 50) / 2;

          //Apply Margin to Popup
          $('#' + popID).css({
              'margin-top' : -popMargTop,
              'margin-left' : -popMargLeft
          });

          //Fade in Background
          $('body').append('<div id="fade"></div>'); //Add the fade layer to bottom of the body tag.
          $('#fade').css({'filter' : 'alpha(opacity=80)'}).fadeIn(); //Fade in the fade layer

          return false;
      });


      //Close Popups and Fade Layer
      $('a.close, #fade').live('click', function() { //When clicking on the close or fade layer...
            $('#fade , .popup_block').fadeOut(function() {
              $('#fade, a.close').remove();
      }); //fade them both out

          return false;
      });


  });
  </script>
  <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAzr2EBOXUKnm_jVnk0OJI7xSosDVG8KKPE1-m51RBrvYughuyMxQ-i1QfUnH94QxWIa6N4U6MouMmBA"
          type="text/javascript"></script>
  <script type="text/javascript">

    function initialize() {
      if (GBrowserIsCompatible()) {
        var map = new GMap2(document.getElementById("map_canvas"));
        map.setCenter(new GLatLng(37.4419, -122.1419), 13);
        map.addControl(new GSmallMapControl());
        map.addControl(new GMapTypeControl());

        // Create our "cafe" marker icon
        var cafeIcon = new GIcon();
        cafeIcon.image = "http://chart.apis.google.com/chart?chst=d_map_pin_icon&chld=cafe|996600";
        cafeIcon.shadow = "http://chart.apis.google.com/chart?chst=d_map_pin_shadow";
        // We don't need to specify iconSize and shadowSize unless we
        // wish to change the default dimensions of the image
        cafeIcon.iconAnchor = new GPoint(6, 20);
        
        // Set up our GMarkerOptions object
        markerOptions = { icon:cafeIcon };

        // Add 10 markers to the map at random locations
        var bounds = map.getBounds();
        var southWest = bounds.getSouthWest();
        var northEast = bounds.getNorthEast();
        var lngSpan = northEast.lng() - southWest.lng();
        var latSpan = northEast.lat() - southWest.lat();
        for (var i = 0; i < 10; i++) {
          var latlng = new GLatLng(southWest.lat() + latSpan * Math.random(),
                                  southWest.lng() + lngSpan * Math.random());
          map.addOverlay(new GMarker(latlng, markerOptions));
        }
      }
    }

    </script>
</head>
<body onload="initialize()" onunload="GUnload()">
	<div id="container">
		<div id="user_nav">
			<% if user_signed_in? %>
				Welcome <%= current_user.email %>.
				<%= link_to "Sign out", destroy_user_session_path %> 
				<%= link_to "Profile", profile_path(current_user.id)%>
			<% else %>
				<%= link_to "Sign in", new_user_session_path %> or 
				<%= link_to "Sign up", new_user_registration_path %>
			<% end %>
		</div>
	</div>

  <p class="notice">Notices: <%= notice %></p>
  <p class="alert">Alerts: <%= alert %></p>

	<%= yield %>

</body>
</html>
